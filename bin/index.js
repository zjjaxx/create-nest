#!/usr/bin/env node
import{parseArgs as se}from"util";var D={name:"create-nest",version:"1.0.0",description:"nest-cli",type:"module",main:"index.js",bin:{"create-nest":"./bin/index.js"},files:["bin","templates","package.json"],engines:{node:">=v18.3.0"},scripts:{build:"tsup",test:'echo "Error: no test specified" && exit 1'},keywords:["nest","cli"],author:"zjjaxx",license:"ISC",devDependencies:{"@changesets/cli":"^2.29.4","@tsconfig/node22":"^22.0.2","@types/node":"^22.15.19",rolldown:"1.0.0-beta.9",tsup:"^8.5.0",typescript:"^5.8.3"},dependencies:{"@clack/prompts":"^0.10.1","create-nest":"link:","gradient-string":"^3.0.0",handlebars:"^4.7.8",picocolors:"^1.1.1"},pnpm:{overrides:{}}};import{intro as ie,text as H,confirm as ae,cancel as ce,multiselect as le,outro as fe}from"@clack/prompts";import X from"gradient-string";var k=X([{color:"#42d392",pos:0},{color:"#42d392",pos:.1},{color:"#647eff",pos:1}])("A universal nestjs template"),E="A universal nestjs template";var R=[{value:"auth",label:"\u9274\u6743"},{value:"cache",label:"\u7F13\u5B58"},{value:"mail",label:"\u90AE\u4EF6"},{value:"swagger",label:"\u63A5\u53E3\u6587\u6863"}];import{isCancel as Z,cancel as M}from"@clack/prompts";import ee from"picocolors";import*as l from"fs";import te from"path";var{red:re,green:Fe,cyan:ke,yellow:Ee}=ee;async function v(e){let t=await e;return Z(t)&&(M(re("\u2716")+" \u64CD\u4F5C\u53D6\u6D88"),process.exit(0)),t}function V(e){if(!l.existsSync(e))return!0;let t=l.readdirSync(e);return t.length===0||t.length===1&&t[0]===".git"}function T(e){return/^(?:@[a-z0-9-*~][a-z0-9-*._~]*\/)?[a-z0-9-~][a-z0-9-._~]*$/.test(e)}function z(e){return e.trim().toLowerCase().replace(/\s+/g,"-").replace(/^[._]/,"").replace(/[^a-z0-9-~]+/g,"-")}function U(e,t,r){for(let s of l.readdirSync(e)){if(s===".git")continue;let n=te.resolve(e,s);if(l.lstatSync(n).isDirectory()){U(n,t,r),t(n);continue}r(n)}}function B(e){l.existsSync(e)&&U(e,t=>l.rmdirSync(t),t=>l.unlinkSync(t))}import*as i from"fs";import*as p from"path";import{pathToFileURL as oe}from"url";var I=e=>e&&typeof e=="object",ne=(e,t)=>Array.from(new Set([...e,...t]));function L(e,t){for(let r of Object.keys(t)){let s=e[r],n=t[r];Array.isArray(s)&&Array.isArray(n)?e[r]=ne(s,n):I(s)&&I(n)?e[r]=L(s,n):e[r]=n}return e}var W=L;function P(e){let t={},r=["dependencies","devDependencies","peerDependencies","optionalDependencies"];for(let s of r)e[s]&&(t[s]={},Object.keys(e[s]).sort().forEach(n=>{t[s][n]=e[s][n]}));return{...e,...t}}function G(e,t,r){if(i.statSync(e).isDirectory()){if(p.basename(e)==="node_modules")return;i.mkdirSync(t,{recursive:!0});for(let o of i.readdirSync(e))G(p.resolve(e,o),p.resolve(t,o),r);return}let n=p.basename(e);if(n==="package.json"&&i.existsSync(t)){let o=JSON.parse(i.readFileSync(t,"utf8")),a=JSON.parse(i.readFileSync(e,"utf8")),O=P(W(o,a));i.writeFileSync(t,JSON.stringify(O,null,2)+`
`);return}if(n.startsWith("_")&&(t=p.resolve(p.dirname(t),n.replace(/^_/,"."))),n==="_gitignore"&&i.existsSync(t)){let o=i.readFileSync(t,"utf8"),a=i.readFileSync(e,"utf8");i.writeFileSync(t,o+`
`+a);return}if(n.endsWith(".data.mjs")){t=t.replace(/\.data\.mjs$/,""),r.push(async o=>{let a=(await import(oe(e).toString())).default;o[t]=await a({oldData:o[t]||{}})});return}i.copyFileSync(e,t)}var J=G;import pe from"picocolors";import x from"path";import d from"fs";import{fileURLToPath as me}from"url";import ue from"handlebars";import*as y from"fs";import*as q from"path";function N(e,t,r){for(let s of y.readdirSync(e)){if(s===".git")continue;let n=q.resolve(e,s);if(y.lstatSync(n).isDirectory()){t(n),y.existsSync(n)&&N(n,t,r);continue}r(n)}}function w(e,t,r){return t==="install"?e==="yarn"?"yarn":`${e} install`:t==="build"?e==="npm"||e==="bun"?`${e} run build`:`${e} build`:r?e==="npm"?`npm run ${t} -- ${r}`:`${e} ${t} ${r}`:e==="npm"?`npm run ${t}`:`${e} ${t}`}var{red:de,green:b,cyan:ft,bold:$,dim:Y}=pe,ye=async()=>{let{values:e,positionals:t}=se({args:process.argv.slice(2),options:{force:{type:"boolean",short:"f"},version:{type:"boolean",short:"v"}},strict:!0,allowPositionals:!0});e.version&&(console.log(`${D.name} v${D.version}`),process.exit(0));let r=t[0],s=r||"nest-project",n=e.force,o={projectName:s,shouldOverwrite:n,packageName:s,features:[]};if(ie(process.stdout.isTTY&&process.stdout.getColorDepth()>8?k:E),!r){let c=await v(H({message:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0",placeholder:s,validate:h=>h.trim().length>0?void 0:"\u9879\u76EE\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}));r=o.projectName=o.packageName=c.trim()}!V(r)&&!n&&(o.shouldOverwrite=await v(ae({message:`${r==="."?"\u5F53\u524D\u76EE\u5F55":`\u76EE\u6807\u6587\u4EF6\u5939 "${r}"`} \u975E\u7A7A\uFF0C\u662F\u5426\u8986\u76D6\uFF1F`,initialValue:!1})),o.shouldOverwrite||(ce(de("\u2716")+" \u64CD\u4F5C\u53D6\u6D88"),process.exit(0))),T(r)||(o.packageName=await v(H({message:"\u8BF7\u8F93\u5165\u5305\u540D\u79F0\uFF1A",initialValue:z(r),validate:c=>T(c)?void 0:"\u65E0\u6548\u7684 package.json \u540D\u79F0"}))),o.features=await v(le({message:`\u8BF7\u9009\u62E9\u8981\u5305\u542B\u7684\u529F\u80FD\uFF1A ${Y("(\u2191/\u2193 \u5207\u6362\uFF0C\u7A7A\u683C\u9009\u62E9\uFF0Ca \u5168\u9009\uFF0C\u56DE\u8F66\u786E\u8BA4)")}`,options:R,required:!1}));let a=x.join(process.cwd(),r);d.existsSync(a)&&o.shouldOverwrite?B(a):d.existsSync(a)||d.mkdirSync(a),console.log(`
\u6B63\u5728\u521D\u59CB\u5316\u9879\u76EE ${a}...`);let O={name:o.packageName,version:"0.0.0"};d.writeFileSync(x.resolve(a,"package.json"),JSON.stringify(O,null,2));let C=me(new URL("../template",import.meta.url)),_=[],f=function(h){let S=x.resolve(C,h);J(S,a,_)};f("base"),o.features.includes("auth")&&(f("config/auth"),f("code/auth")),o.features.includes("cache")&&(f("config/cache"),f("code/cache")),o.features.includes("mail")&&(f("config/mail"),f("code/mail")),o.features.includes("swagger")&&(f("config/swagger"),f("code/swagger"));let A={};for(let c of _)await c(A);N(a,()=>{},c=>{if(c.endsWith(".handlebars")){let h=d.readFileSync(c,"utf-8"),S=c.replace(/\.handlebars$/,""),K=ue.compile(h)(A[S]);d.writeFileSync(S,K),d.unlinkSync(c)}});let j=process.env.npm_config_user_agent??"",F=/pnpm/.test(j)?"pnpm":/yarn/.test(j)?"yarn":/bun/.test(j)?"bun":"npm",g=`\u9879\u76EE\u521D\u59CB\u5316\u5B8C\u6210\uFF0C\u53EF\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\uFF1A

`;if(a!==process.cwd()){let c=x.relative(process.cwd(),a);g+=`   ${$(b(`cd ${c.includes(" ")?`"${c}"`:c}`))}
`}g+=`   ${$(b(w(F,"install")))}
`,g+=`   ${$(b(w(F,"dev")))}
`,g+=`
      ${Y("|")} \u53EF\u9009\uFF1A\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u5728\u9879\u76EE\u76EE\u5F55\u4E2D\u521D\u59CB\u5316 Git\uFF1A
         
         ${$(b('git init && git add -A && git commit -m "initial commit"'))}`,fe(g)};ye().catch(e=>{console.error(e),process.exit(1)});
//# sourceMappingURL=index.js.map